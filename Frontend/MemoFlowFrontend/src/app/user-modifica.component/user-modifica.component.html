<div class="card-base card-full-page form-margin-top">

  <!-- Barra Tab -->
  <div class="tab-header">
    <button 
      class="tab-button" 
      [class.active]="activeTab === 'anagrafica'" 
      (click)="activeTab = 'anagrafica'">
      Anagrafica
    </button>
    <button 
      class="tab-button" 
      [class.active]="activeTab === 'email'" 
      (click)="activeTab = 'email'">
      Email
    </button>
    <button 
      class="tab-button" 
      [class.active]="activeTab === 'password'" 
      (click)="activeTab = 'password'">
      Password
    </button>
  </div>

  <div class="card-content-base">

    <!-- Messaggi globali -->
    <div *ngIf="successMessage" class="message-base success-message">
      {{ successMessage }}
    </div>
    <div *ngIf="errorMessage" class="message-base error-message">
      {{ errorMessage }}
    </div>

    <!-- TAB: Anagrafica -->
    <div *ngIf="activeTab === 'anagrafica'">
      <h2 class="form-title-base">Modifica Dati Utente</h2>
      <form [formGroup]="form" (ngSubmit)="onSaveUser()" novalidate>
        <div class="form-group">
          <label for="nome" class="form-label-base">Nome:</label>
          <input id="nome" formControlName="nome" type="text" class="form-input-base" placeholder="Il tuo nome"/>
        </div>
        
        <div class="form-group">
          <label for="cognome" class="form-label-base">Cognome:</label>
          <input id="cognome" formControlName="cognome" type="text" class="form-input-base" placeholder="Il tuo cognome"/>
        </div>

        <div class="flex-row reverse-flex">
          <button type="submit" [disabled]="form.invalid" class="button-base button-primary">
            Salva Anagrafica
          </button>
        </div>
      </form>
    </div>

    <!-- TAB: Email -->
    <div *ngIf="activeTab === 'email'">
      <h2 class="form-title-base">Cambia Email</h2>
      <form [formGroup]="emailForm" (ngSubmit)="OnChangeEmail()" novalidate>
        <div class="form-group">
          <label for="vecchiaEmail" class="form-label-base">Email Attuale:</label>
          <input id="vecchiaEmail" formControlName="vecchiaEmail" type="email" class="form-input-base" placeholder="La tua email attuale"/>
        </div>

        <div class="form-group">
          <label for="nuovaEmail" class="form-label-base">Nuova Email:</label>
          <input id="nuovaEmail" formControlName="nuovaEmail" type="email" class="form-input-base" placeholder="La tua nuova email"/>
        </div>

        <div class="flex-row reverse-flex">
          <button type="submit" [disabled]="emailForm.invalid" class="button-base button-primary">
            Aggiorna Email
          </button>
        </div>
      </form>
    </div>

    <!-- TAB: Password -->
    <div *ngIf="activeTab === 'password'">
      <h2 class="form-title-base">Cambia Password</h2>
      <form [formGroup]="passwordForm" (ngSubmit)="onChangePassword()" novalidate>
        <div class="form-group">
          <label for="oldPassword" class="form-label-base">Password Attuale:</label>
          <div class="password-container">
            <input id="oldPassword" formControlName="oldPassword" [type]="oldPasswordType" class="form-input-base" placeholder="La tua password attuale"/>
            <span class="password-toggle-icon" (click)="toggleOldPasswordVisibility()">
              <i class="fas fa-eye" *ngIf="oldPasswordType === 'password'"></i>
              <i class="fas fa-eye-slash" *ngIf="oldPasswordType === 'text'"></i>
            </span>
          </div>
        </div>
        
        <div class="form-group">
          <label for="newPassword" class="form-label-base">Nuova Password:</label>
          <div class="password-container">
            <input id="newPassword" formControlName="newPassword" [type]="newPasswordType" class="form-input-base" placeholder="La tua nuova password"/>
            <span class="password-toggle-icon" (click)="toggleNewPasswordVisibility()">
              <i class="fas fa-eye" *ngIf="newPasswordType === 'password'"></i>
              <i class="fas fa-eye-slash" *ngIf="newPasswordType === 'text'"></i>
            </span>
          </div>
        </div>
        
        <div class="flex-row reverse-flex">
          <button type="submit" [disabled]="passwordForm.invalid" class="button-base button-primary">
            Aggiorna Password
          </button>
        </div>
      </form>
    </div>

  </div>
</div>
